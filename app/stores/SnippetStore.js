"use strict";function getModes(){return _modes}function getActiveMode(){return _activeMode}function setActiveMode(e,t){var i=MODES[e];i&&("add"===i&&resetActive(),_activeMode=i,t())}function getActiveSnippet(){return _activeSnippet}function setActiveSnippet(e,t){var i=getById(e);_activeSnippet&&_activeSnippet.id===i.id||(_activeSnippet=i,t())}function resetActiveSnippet(){_activeSnippet=null}function getSnippets(){return _snippets}function getSnippetById(e){for(var t=null,i=_snippets.length,p=0;i>p;p++)if(_snippets[p].id===e){t=_snippets[p];break}return t}function create(e,t){var i=data.snippetExists(e.text);if(!i){var p=data.snippetModel(e.title,e.text,e.tags,e.lang);p&&(_snippets.push(p),data.write("snippets",_snippets,function(){setActiveSnippet(p.id),setActiveMode(MODES.preview),t()}))}}function update(e,t){var i=data.snippetModel(e.title,e.text,e.tags,e.lang);if(i)for(var p=0;p<_snippets.length;p++)if(_activeSnippet.id===_snippets[p].id){_snippets[p].title=i.title,_snippets[p].text=i.text,_snippets[p].tags=i.tags,_snippets[p].lang=i.lang,data.write("snippets",_snippets,function(){setActiveSnippet(_activeSnippet.id),setActiveMode(MODES.preview),t()});break}}function destroy(e){for(var t=_snippets.length,i=0;t>i;i++)if(_snippets[i].id===_activeSnippet.id){resetActiveSnippet(),setActiveMode(MODES.empty),data.write("snippets",_snippets,function(){e()});break}}var EventEmitter=require("events").EventEmitter,assign=require("react/lib/Object.assign"),AppDispatcher=require("../dispatcher/AppDispatcher"),SnippetBarConstants=require("../constants/SnippetBarConstants"),data=require("../data"),CHANGE_EVENT="change",_modes={empty:"empty",preview:"preview",add:"add",edit:"edit"},_activeMode="preview",_activeSnippet=null,_snippets=[],SnippetStore=assign({},EventEmitter.prototype,{getModes:getModes,getActiveMode:getActiveMode,getActiveSnippet:getActiveSnippet,getSnippets:getSnippets,getSnippetById:getSnippetById,emitChange:function(){this.emit(CHANGE_EVENT)},addChangeListener:function(e){this.on(CHANGE_EVENT,e)},removeChangeListener:function(e){this.removeListener(CHANGE_EVENT,e)}});SnippetStore.dispatchToken=AppDispatcher.register(function(e){switch(e.actionType){case SnippetBarConstants.LOAD_SNIPPETS:e.snippets&&(_snippets=e.snippets,SnippetStore.emitChange());break;case SnippetBarConstants.SNIPPET_CREATE:create(e.values,SnippetStore.emitChange);break;case SnippetBarConstants.SNIPPET_UPDATE:update(e.values,SnippetStore.emitChange);break;case SnippetBarConstants.SNIPPET_DELETE:destroy(SnippetStore.emitChange);break;case SnippetBarConstants.SNIPPET_SET_ACTIVE:update(e.id,SnippetStore.emitChange);break;case SnippetBarConstants.MODE_SET_ACTIVE:setActiveMode(e.mode,SnippetStore.emitChange)}}),module.exports=SnippetStore;